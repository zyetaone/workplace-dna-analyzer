import{c as je,a as y,l as Re}from"../chunks/CM4y3QyB.js";import{t as r,s as u,g as e,i,q as T,x as Q,o as m,d as Pe,p as Te,u as We,a as z,f as v,h as Be,l as h,F as x,k as w,v as ne,w as re,r as c,b as I,c as ie,m as L,j as ae,aA as Oe,n as Ge}from"../chunks/oQ9KHoCl.js";import{i as q}from"../chunks/B6Yvxf5m.js";import{e as He,i as Je}from"../chunks/D6uOdIwr.js";import{a as fe,r as Ke,s as Ue}from"../chunks/C6U6iv39.js";import{s as Ve}from"../chunks/CjJHMaRL.js";import{a as ge,q as Xe,l as P}from"../chunks/B_OUDf4Y.js";import{p as ve}from"../chunks/CVfayQeD.js";import{g as Ze}from"../chunks/BXtNqw99.js";class $e{#e=r(u(null),"AttendeeQuizStore.sessionId");get sessionId(){return e(this.#e)}set sessionId(t){i(this.#e,t,!0)}#t=r(u(null),"AttendeeQuizStore.attendeeId");get attendeeId(){return e(this.#t)}set attendeeId(t){i(this.#t,t,!0)}#s=r(u(""),"AttendeeQuizStore.attendeeName");get attendeeName(){return e(this.#s)}set attendeeName(t){i(this.#s,t,!0)}#n=r(u(""),"AttendeeQuizStore.generation");get generation(){return e(this.#n)}set generation(t){i(this.#n,t,!0)}#r=r(u(T([])),"AttendeeQuizStore.questions");get questions(){return e(this.#r)}set questions(t){i(this.#r,t,!0)}#i=r(u(T({})),"AttendeeQuizStore.responses");get responses(){return e(this.#i)}set responses(t){i(this.#i,t,!0)}#a=r(u(0),"AttendeeQuizStore.currentQuestionIndex");get currentQuestionIndex(){return e(this.#a)}set currentQuestionIndex(t){i(this.#a,t,!0)}#o=r(u(!1),"AttendeeQuizStore.isLoading");get isLoading(){return e(this.#o)}set isLoading(t){i(this.#o,t,!0)}#l=r(u(!1),"AttendeeQuizStore.isSubmitting");get isSubmitting(){return e(this.#l)}set isSubmitting(t){i(this.#l,t,!0)}#u=r(u(!1),"AttendeeQuizStore.isCompleted");get isCompleted(){return e(this.#u)}set isCompleted(t){i(this.#u,t,!0)}#d=r(Q(()=>this.questions[this.currentQuestionIndex]),"AttendeeQuizStore.currentQuestion");get currentQuestion(){return e(this.#d)}set currentQuestion(t){i(this.#d,t)}#c=r(Q(()=>this.questions.length>0?(this.currentQuestionIndex+1)/this.questions.length*100:0),"AttendeeQuizStore.progress");get progress(){return e(this.#c)}set progress(t){i(this.#c,t)}#h=r(Q(()=>{const t={collaboration:0,formality:0,tech:0,wellness:0};let n=0;return this.questions.forEach((d,_)=>{if(m(_,0))return;const s=this.responses[_];if(s){const p=d.options?.find(B=>m(B.id,s));p?.values&&(t.collaboration+=p.values.collaboration||0,t.formality+=p.values.formality||0,t.tech+=p.values.tech||0,t.wellness+=p.values.wellness||0,n++)}}),n>0&&(t.collaboration=Math.round(t.collaboration/n),t.formality=Math.round(t.formality/n),t.tech=Math.round(t.tech/n),t.wellness=Math.round(t.wellness/n)),t}),"AttendeeQuizStore.preferenceScores");get preferenceScores(){return e(this.#h)}set preferenceScores(t){i(this.#h,t)}#p=r(Q(()=>{const{collaboration:t,formality:n,tech:d,wellness:_}=this.preferenceScores,s=[];return t>=7?s.push("Collaborative"):t>=4?s.push("Balanced"):s.push("Independent"),n>=7?s.push("Structured"):n>=4?s.push("Flexible"):s.push("Casual"),d>=7?s.push("Tech-Forward"):d>=4?s.push("Tech-Enabled"):s.push("Traditional"),_>=7?s.push("Wellness-Focused"):_>=4?s.push("Balance-Aware"):s.push("Performance-Driven"),s.join(" â€¢ ")}),"AttendeeQuizStore.workplaceDNA");get workplaceDNA(){return e(this.#p)}set workplaceDNA(t){i(this.#p,t)}#f=r(Q(()=>{const{collaboration:t,formality:n,tech:d,wellness:_}=this.preferenceScores,s=[];return t>=7?s.push("You thrive in team environments and value open communication"):t<=3&&s.push("You prefer focused, independent work with minimal interruptions"),n>=7?s.push("You appreciate structure and clear processes"):n<=3&&s.push("You enjoy flexibility and informal work environments"),d>=7?s.push("You embrace cutting-edge tools and digital solutions"):d<=3&&s.push("You value proven methods and face-to-face interactions"),_>=7?s.push("Work-life balance is a top priority for you"):_<=3&&s.push("You are highly driven and results-focused"),s}),"AttendeeQuizStore.personalityInsights");get personalityInsights(){return e(this.#f)}set personalityInsights(t){i(this.#f,t)}initialize(t,n,d){this.sessionId=t,this.attendeeId=n,this.questions=d,this.currentQuestionIndex=0,this.responses={},this.isCompleted=!1}selectOption(t){if(this.responses[this.currentQuestionIndex]=t,m(this.currentQuestionIndex,0)){const n=this.currentQuestion?.options.find(d=>m(d.id,t));n&&(this.generation=n.text)}}nextQuestion(){return this.currentQuestionIndex<this.questions.length-1?(this.currentQuestionIndex++,!0):!1}previousQuestion(){return this.currentQuestionIndex>0?(this.currentQuestionIndex--,!0):!1}get allQuestionsAnswered(){return this.questions.every((t,n)=>m(this.responses[n],void 0,!1))}completeQuiz(){this.isCompleted=!0}reset(){this.sessionId=null,this.attendeeId=null,this.attendeeName="",this.generation="",this.questions=[],this.responses={},this.currentQuestionIndex=0,this.isLoading=!1,this.isSubmitting=!1,this.isCompleted=!1}}const oe=new $e,et=ge("1vxpwt5/completeQuiz"),tt=Xe("1vxpwt5/loadAttendeeData"),st=ge("1vxpwt5/saveResponse");l[x]="src/routes/session/[sessionId]/attendee/[attendeeId]/+page.svelte";var nt=y(w('<div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full"><h1 class="text-2xl font-bold text-gray-800 mb-4">Loading...</h1> <p class="text-gray-600">Retrieving your session data...</p></div>'),l[x],[[151,2,[[152,3],[153,3]]]]),rt=y(w('<div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full"><h1 class="text-2xl font-bold text-gray-800 mb-4">Session Not Found</h1> <p class="text-gray-600">Please check your link and try again.</p></div>'),l[x],[[157,2,[[158,3],[159,3]]]]),it=y(w('<span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>',1),l[x],[[172,7],[173,7]]),at=y(w('<span class="animate-pulse relative inline-flex rounded-full h-2 w-2 bg-yellow-500"></span>'),l[x],[[175,7]]),ot=y(w('<span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>'),l[x],[[177,7]]),lt=(W,t,n)=>t(e(n).id),ut=y(w('<div class="text-sm text-gray-500 mt-1"> </div>'),l[x],[[212,7]]),dt=y(w('<button><div class="font-semibold text-gray-700"> </div> <!></button>'),l[x],[[203,5,[[210,6]]]]),ct=y(w('<div class="mt-4 text-center text-sm text-gray-600">Saving your response...</div>'),l[x],[[220,4]]),ht=y(w('<div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full"><div class="mb-4 flex justify-between items-center"><div class="text-sm text-gray-600">Welcome back, <span class="font-semibold"> </span></div> <div class="flex items-center gap-1"><span class="relative flex h-2 w-2"><!></span></div></div> <div class="mb-6"><div class="flex justify-between text-sm text-gray-600 mb-2"><span> </span> <span> </span></div> <div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-gray-600 h-2 rounded-full transition-all duration-300"></div></div></div> <h2 class="text-2xl font-bold text-gray-800 mb-6"> </h2> <div class="space-y-3"></div> <!></div>'),l[x],[[163,2,[[165,3,[[166,4,[[167,19]]],[169,4,[[170,5]]]]],[184,3,[[185,4,[[186,5],[187,5]]],[189,4,[[190,5]]]]],[198,3],[201,3]]]]),pt=y(w('<div class="min-h-screen animated-gradient flex items-center justify-center px-4"><!></div>'),l[x],[[140,0]]);function l(W,t){je(new.target),Te(t,!0,l);let n=r(Q(()=>ve.params.sessionId),"sessionId"),d=r(Q(()=>ve.params.attendeeId),"attendeeId"),_=r(u(null),"session"),s=r(u(null),"attendee"),p=r(u(T([])),"questions"),B=r(u(""),"sessionCode"),b=r(u(0),"currentQuestion"),F=r(u(T({})),"responses"),k=r(u(!1),"isSubmitting"),M=r(u(!0),"isLoading"),Y=r(u("connecting"),"connectionStatus"),O=r(Q(()=>e(p)[e(b)]),"question"),le=r(Q(()=>e(p).length>0?(e(b)+1)/e(p).length*100:0),"progress");We(()=>{if(!e(n)||!e(d)){(m(e(n),void 0)||m(e(d),void 0))&&(console.warn("Missing session or attendee ID"),i(M,!1));return}tt({sessionId:e(n),attendeeId:e(d)}).then(a=>{if(i(_,a.session,!0),i(s,a.attendee,!0),i(p,a.questions,!0),i(B,a.sessionCode,!0),e(s)?.responses){i(F,e(s).responses,!0);for(let o=0;o<e(p).length;o++)if(!e(F)[o]){i(b,o,!0);break}}i(M,!1)}).catch(a=>{console.error(...P("error","Failed to load session:",a)),i(M,!1)})});async function me(a){if(!e(k)){i(k,!0),e(F)[e(b)]=a;try{const o=m(e(b),0)?a:void 0;(await ae(st({sessionId:e(n),attendeeId:e(d),questionIndex:e(b),response:a,generation:o})))(),e(b)<e(p).length-1?Oe(b):(await ae(xe()))()}catch(o){console.error(...P("error","Failed to save response:",o)),alert("Failed to save your response. Please try again.")}finally{i(k,!1)}}}async function xe(){oe.initialize(e(n),e(d),e(p)),oe.responses=e(F);const a=oe.preferenceScores;console.log(...P("log","Final calculated scores from store:",a));try{const o=(await ae(et({sessionId:e(n),attendeeId:e(d),scores:a})))();o.redirect&&Ze(o.redirect)}catch(o){console.error(...P("error","Failed to complete quiz:",o)),alert("Failed to submit results. Please try again.")}}function _e(a){function o(){i(Y,"connected")}function j(){i(Y,"disconnected")}return a.addEventListener("realtime:connected",o),a.addEventListener("realtime:disconnected",j),()=>{a.removeEventListener("realtime:connected",o),a.removeEventListener("realtime:disconnected",j)}}var N=pt(),be=h(N);{var ye=a=>{var o=nt();v(a,o)},we=a=>{var o=ne(),j=re(o);{var Ie=C=>{var R=rt();v(C,R)},Qe=C=>{var R=ne(),Se=re(R);{var Ae=G=>{var H=ht(),J=h(H),K=h(J),ue=I(h(K)),ze=h(ue,!0);c(ue),c(K);var de=I(K,2),ce=h(de),qe=h(ce);{var ke=f=>{var g=it();Ge(2),v(f,g)},Ce=f=>{var g=ne(),S=re(g);{var D=A=>{var E=at();v(A,E)},ee=A=>{var E=ot();v(A,E)};z(()=>q(S,A=>{m(e(Y),"connecting")?A(D):A(ee,!1)},!0),"if",l,174,6)}v(f,g)};z(()=>q(qe,f=>{m(e(Y),"connected")?f(ke):f(Ce,!1)}),"if",l,171,6)}c(ce),c(de),c(J);var U=I(J,2),V=h(U),X=h(V),Le=h(X);c(X);var he=I(X,2),Fe=h(he);c(he),c(V);var pe=I(V,2),Ne=h(pe);c(pe),c(U);var Z=I(U,2),De=h(Z,!0);c(Z);var $=I(Z,2);z(()=>He($,21,()=>e(O).options,Je,(f,g)=>{var S=dt();S.__click=[lt,me,g];var D=h(S),ee=h(D,!0);c(D);var A=I(D,2);{var E=te=>{var se=ut(),Ye=h(se,!0);c(se),ie(()=>L(Ye,e(g).description)),v(te,se)};z(()=>q(A,te=>{e(g).description&&te(E)}),"if",l,211,6)}c(S),ie(()=>{S.disabled=e(k),Ue(S,1,`w-full p-4 text-left border-2 border-gray-200 rounded-lg transition
						       ${m(e(F)[e(b)],e(g).id)?"border-gray-600 bg-gray-50":""}
						       ${e(k)?"opacity-50 cursor-not-allowed":"hover:border-gray-400 hover:bg-gray-50"}`),L(ee,e(g).label)}),v(f,S)}),"each",l,202,4),c($);var Ee=I($,2);{var Me=f=>{var g=ct();v(f,g)};z(()=>q(Ee,f=>{e(k)&&f(Me)}),"if",l,219,3)}c(H),ie(f=>{L(ze,e(s).name),L(Le,`Question ${e(b)+1} of ${e(p).length??""}`),L(Fe,`${f??""}% Complete`),Ve(Ne,`width: ${e(le)??""}%`),L(De,e(O).title)},[()=>Math.round(e(le))]),v(G,H)};z(()=>q(Se,G=>{e(O)&&G(Ae)},!0),"if",l,161,1)}v(C,R)};z(()=>q(j,C=>{e(s)?C(Qe,!1):C(Ie)},!0),"if",l,155,1)}v(a,o)};z(()=>q(be,a=>{e(M)?a(ye):a(we,!1)}),"if",l,149,1)}return c(N),fe(N,()=>Ke({url:`/api/sessions/${e(n)}/stream`,reconnect:!0,reconnectDelay:1e3})),fe(N,()=>_e),v(W,N),Be({...Re()})}Pe(["click"]);export{l as component};
