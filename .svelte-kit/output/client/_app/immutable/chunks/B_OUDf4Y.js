import{X as v,ag as A,b8 as M,al as J,aF as N,b9 as R,o as h,au as C,b5 as k,j as p,t as l,aA as O,s as g,g as a,q as D,x as j,i as f}from"./oQ9KHoCl.js";import{a as S,b as _,q as d,c as q,d as F,H as b,g as H,R as B,e as P,f as E,h as L,r as V}from"./BXtNqw99.js";var X="font-weight: bold",Y="font-weight: normal";function Q(t){console.warn(`%c[svelte] state_snapshot_uncloneable
%c${t?`The following properties cannot be cloned with \`$state.snapshot\` — the return value contains the originals:

${t}`:"Value cannot be cloned with `$state.snapshot` — the original value was returned"}
https://svelte.dev/e/state_snapshot_uncloneable`,X,Y)}const z=[];function G(t,e=!1,s=!1){if(!e){const n=[],r=y(t,new Map,"",n,null,s);if(n.length===1&&n[0]==="")Q();else if(n.length>0){const o=n.length>10?n.slice(0,7):n.slice(0,10),c=n.length-o.length;let i=o.map(u=>`- <value>${u}`).join(`
`);c>0&&(i+=`
- ...and ${c} more`),Q(i)}return r}return y(t,new Map,"",z,null,s)}function y(t,e,s,n,r=null,o=!1){if(typeof t=="object"&&t!==null){var c=e.get(t);if(c!==void 0)return c;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(v(t)){var i=Array(t.length);e.set(t,i),r!==null&&e.set(r,i);for(var u=0;u<t.length;u+=1){var T=t[u];u in t&&(i[u]=y(T,e,`${s}[${u}]`,n,null,o))}return i}if(A(t)===M){i={},e.set(t,i),r!==null&&e.set(r,i);for(var w in t)i[w]=y(t[w],e,`${s}.${w}`,n,null,o);return i}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!o)return y(t.toJSON(),e,`${s}.toJSON()`,n,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return n.push(s),t}}function re(t,...e){return J(()=>{try{let s=!1;const n=[];for(const r of e)r&&typeof r=="object"&&N in r?(n.push(G(r,!0)),s=!0):n.push(r);s&&(R(t),console.log("%c[snapshot]","color: grey",...n))}catch{}}),e}async function I(t){const e=(await p(fetch(t)))();if(!e.ok)throw new b(500,"Failed to execute remote function");const s=(await p(e.json()))();if(h(s.type,"redirect"))throw(await p(H(s.location)))(),(await p(new Promise(n=>setTimeout(n,100))))(),new B(307,s.location);if(h(s.type,"error"))throw new b(s.status??500,s.error);return S(s.result,_.decoders)}function K(t,e){return s=>{const n=q(s,_.hooks.transport),r=F(t,n);let o=d.get(r),c=!0;try{C(()=>(o&&o.count++,()=>{const u=d.get(r);u&&(u.count--,k().then(()=>{!u.count&&h(u,d.get(r))&&d.delete(r)}))}))}catch{c=!1}let i=o?.resource;return i||(i=e(r,n),Object.defineProperty(i,"_key",{value:r}),d.set(r,o={count:c?1:0,resource:i}),i.then(()=>{k().then(()=>{!o.count&&h(o,d.get(r))&&d.delete(r)})}).catch(()=>{d.delete(r)})),i}}function m(t){for(const e of t)"release"in e&&e.release()}function U(t,e=[]){const s=Object.entries(S(t,_.decoders));for(const[n,r]of s){const o=e.find(i=>h(i._key,n));o&&"release"in o&&o.release(),d.get(n)?.resource.set(r)}}function $(t){let e=l(g(0),"pending_count");const s=n=>{let r=[];O(e);const o=(async()=>{try{(await p(Promise.resolve()))();const c=(await p(fetch(`${P}/${E}/remote/${t}`,{method:"POST",body:JSON.stringify({payload:q(n,_.hooks.transport),refreshes:r.map(u=>u._key)}),headers:{"Content-Type":"application/json"}})))();if(!c.ok)throw m(r),new Error("Failed to execute remote function");const i=(await p(c.json()))();if(h(i.type,"redirect"))throw m(r),new Error("Redirects are not allowed in commands. Return a result instead and use goto on the client");if(h(i.type,"error"))throw m(r),new b(i.status??500,i.error);return i.refreshes&&U(i.refreshes,r),S(i.result,_.decoders)}finally{O(e,-1)}})();return o.updates=(...c)=>(r=c,delete o.updates,o),o};return Object.defineProperty(s,"pending",{get:()=>a(e)}),s}function x(t){return K(t,(e,s)=>new W(e,async()=>{if(!L){const r=V[e];if(r)return r}const n=`${P}/${E}/remote/${t}${s?`?payload=${s}`:""}`;return(await p(I(n)))()}))}class W{_key;#c=!1;#u;#e=l(g(!0),"Query.#loading");#t=[];#n=l(g(!1),"Query.#ready");#a=l(g(),"Query.#raw");#o;#r=l(g(D([])),"Query.#overrides");#f=l(j(()=>{if(a(this.#n))return a(this.#r).reduce((e,s)=>s(e),a(this.#a))}),"Query.#current");#i=l(g(void 0),"Query.#error");#s=l(j(()=>{const e=a(this.#o);return a(this.#r).length,async(s,n)=>{try{(await p(e))(),await k(),s?.(a(this.#f))}catch(r){n?.(r)}}}),"Query.#then");constructor(e,s){this._key=e,this.#u=s,this.#o=l(g(this.#h()),"Query.#promise")}#h(){this.#c?f(this.#e,!0):this.#c=!0;let e,s;const n=new Promise((r,o)=>{e=r,s=o});return this.#t.push(e),Promise.resolve(this.#u()).then(r=>{const o=this.#t.indexOf(e);h(o,-1)||(this.#t.splice(0,o).forEach(c=>c()),f(this.#n,!0),f(this.#e,!1),f(this.#a,r),f(this.#i,void 0),e())}).catch(r=>{const o=this.#t.indexOf(e);h(o,-1)||(this.#t.splice(0,o).forEach(c=>c()),f(this.#i,r),f(this.#e,!1),s(r))}),n}get then(){return a(this.#s)}get catch(){return a(this.#s),e=>a(this.#s)(void 0,e)}get finally(){return a(this.#s),e=>a(this.#s)(()=>e(),()=>e())}get current(){return a(this.#f)}get error(){return a(this.#i)}get loading(){return a(this.#e)}get ready(){return a(this.#n)}refresh(){return f(this.#o,this.#h())}set(e){f(this.#n,!0),f(this.#e,!1),f(this.#i,void 0),f(this.#a,e),f(this.#o,Promise.resolve())}withOverride(e){return a(this.#r).push(e),{_key:this._key,release:()=>{const s=a(this.#r).indexOf(e);h(s,-1,!1)&&a(this.#r).splice(s,1)}}}}const se=$("xu03kg/createSession"),ne=x("xu03kg/getActiveSessions"),oe=x("xu03kg/getSession"),ie=$("xu03kg/joinSession"),ae=x("xu03kg/refreshSessionData");$("xu03kg/updateSession");export{$ as a,oe as b,se as c,ne as g,ie as j,re as l,x as q,ae as r};
